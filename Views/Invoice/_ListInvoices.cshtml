@model List<hongWenAPP.Models.InvoiceModel.DTOs.GetInvoiceDTO>

<table class="table table-hover">
    <thead class="table-light">
        <tr>
            <th>Invoice #</th>
            <th>Student</th>
            <th>Course</th>
            <th>Invoice Date</th>
            <th>Due Date</th>
            <th>Total Amount</th>
            <th>Amount Paid</th>
            <th>Outstanding</th>
            <th>Status</th>
            <th>Type</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @if (Model == null || !Model.Any())
        {
            <tr>
                <td colspan="11" class="text-center">No invoices found</td>
            </tr>
        }
        else
        {
            foreach (var invoice in Model)
            {
                var statusClass = invoice.Status switch
                {
                    "Paid" => "success",
                    "Overdue" => "danger",
                    "PartiallyPaid" => "warning",
                    "Issued" => "info",
                    "Draft" => "secondary",
                    "Voided" => "dark",
                    _ => "secondary"
                };

                var typeClass = invoice.InvoiceType switch
                {
                    "NewStudent" => "primary",
                    "Promoted" => "info",
                    "Adjustment" => "warning",
                    _ => "secondary"
                };

                <tr>
                    <td>
                        <strong>@invoice.InvoiceNumber</strong>
                        @if (invoice.IsAutogenerated)
                        {
                            <i class="bx bx-bot text-primary ms-1" title="Auto-generated"></i>
                        }
                    </td>
                    <td>
                        <div>@invoice.StudentName</div>
                        <small class="text-muted">@invoice.StudentCode</small>
                    </td>
                    <td>@invoice.CourseName</td>
                    <td>@invoice.InvoiceDate.ToString("MMM dd, yyyy")</td>
                    <td>
                        @invoice.DueDate.ToString("MMM dd, yyyy")
                        @if (invoice.DueDate < DateTime.Now && invoice.AmountOutstanding > 0)
                        {
                            <br /><small class="text-danger">@((DateTime.Now - invoice.DueDate).Days) days overdue</small>
                        }
                    </td>
                    <td class="text-end">$@invoice.TotalAmount.ToString("N2")</td>
                    <td class="text-end text-success">$@invoice.AmountPaid.ToString("N2")</td>
                    <td class="text-end">
                        <strong class="@(invoice.AmountOutstanding > 0 ? "text-danger" : "text-success")">
                            $@invoice.AmountOutstanding.ToString("N2")
                        </strong>
                    </td>
                    <td>
                        <span class="badge bg-@statusClass">@invoice.Status</span>
                    </td>
                    <td>
                        <span class="badge bg-@typeClass">@invoice.InvoiceType</span>
                    </td>
                    <td>
                        <div class="dropdown">
                            <button type="button" class="btn p-0 dropdown-toggle hide-arrow" data-bs-toggle="dropdown">
                                <i class="bx bx-dots-vertical-rounded"></i>
                            </button>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="@Url.Action("Details", "Invoice", new { id = invoice.InvoiceId })">
                                    <i class="bx bx-show me-1"></i> View Details
                                </a>
                                @if (invoice.AmountOutstanding > 0 && invoice.Status != "Voided")
                                {
                                    <a class="dropdown-item" href="@Url.Action("RecordPayment", "PaymentNew", new { invoiceId = invoice.InvoiceId })" modal-popup="" modal-size="lg">
                                        <i class="bx bx-dollar me-1"></i> Record Payment
                                    </a>
                                }
                                @if (invoice.Status == "Draft")
                                {
                                    <a class="dropdown-item" href="@Url.Action("AddLineItem", "Invoice", new { invoiceId = invoice.InvoiceId })" modal-popup="">
                                        <i class="bx bx-list-plus me-1"></i> Add Line Item
                                    </a>
                                    <a class="dropdown-item" href="@Url.Action("ApplyDiscount", "Invoice", new { invoiceId = invoice.InvoiceId })" modal-popup="">
                                        <i class="bx bx-purchase-tag me-1"></i> Apply Discount
                                    </a>
                                }
                            </div>
                        </div>
                    </td>
                </tr>
            }
        }
    </tbody>
</table>

