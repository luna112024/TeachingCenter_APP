@model UpdateStudentFeeDTO

<form asp-action="EditStudentFee" asp-controller="StudentFee" method="post" autocomplete="off">
    <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">Edit Student Fee</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>
    <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
        <input asp-for="StudentFeeId" type="hidden" />
        
        <!-- Student Information Display -->
        <div class="row g-3 mb-3">
            <div class="col-12">
                <div class="alert alert-info d-flex align-items-center">
                    <i class="bx bx-user me-2"></i>
                    <div>
                        <strong>Student:</strong> @(ViewBag.StudentName ?? "Unknown") 
                        @if (!string.IsNullOrEmpty(ViewBag.StudentCode?.ToString()))
                        {
                            <span class="text-muted">(@ViewBag.StudentCode)</span>
                        }
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row g-3">
            <div class="col-6 mb-2">
                <label class="form-label" asp-for="FeeName">Fee Name<span class="text-danger">*</span></label>
                <input asp-for="FeeName" type="text" class="form-control" placeholder="Fee name" required />
                <span asp-validation-for="FeeName" class="text-danger"></span>
            </div>
            <div class="col-6 mb-2">
                <label class="form-label" asp-for="FeeType">Fee Type<span class="text-danger">*</span></label>
                <select asp-for="FeeType" class="form-select" required>
                    <option value="">Select Fee Type</option>
                    <option value="Tuition">Tuition</option>
                    <option value="Registration">Registration</option>
                    <option value="Materials">Materials</option>
                    <option value="Exam">Exam</option>
                    <option value="Certificate">Certificate</option>
                    <option value="Late Fee">Late Fee</option>
                    <option value="Deposit">Deposit</option>
                    <option value="Other">Other</option>
                </select>
                <span asp-validation-for="FeeType" class="text-danger"></span>
            </div>
        </div>
        <div class="row g-3">
            <div class="col-6 mb-2">
                <label class="form-label" asp-for="OriginalAmount">Original Amount<span class="text-danger">*</span></label>
                <input asp-for="OriginalAmount" type="number" step="0.01" min="0.01" class="form-control" placeholder="0.00" required id="originalAmount" />
                <span asp-validation-for="OriginalAmount" class="text-danger"></span>
            </div>
            <div class="col-6 mb-2">
                <label class="form-label" asp-for="DiscountAmount">Discount Amount</label>
                <input asp-for="DiscountAmount" type="number" step="0.01" min="0" class="form-control" placeholder="0.00" id="discountAmount" />
                <span asp-validation-for="DiscountAmount" class="text-danger"></span>
            </div>
        </div>
        <div class="row g-3">
            <div class="col-6 mb-2">
                <label class="form-label" asp-for="FinalAmount">Final Amount<span class="text-danger">*</span></label>
                <input asp-for="FinalAmount" type="number" step="0.01" min="0.01" class="form-control" placeholder="0.00" required id="finalAmount" readonly />
                <span asp-validation-for="FinalAmount" class="text-danger"></span>
            </div>
            <div class="col-6 mb-2">
                <label class="form-label" asp-for="Currency">Currency<span class="text-danger">*</span></label>
                <select asp-for="Currency" class="form-select" required>
                    <option value="USD">USD</option>
                    <option value="KHR">KHR</option>
                    <option value="EUR">EUR</option>
                </select>
                <span asp-validation-for="Currency" class="text-danger"></span>
            </div>
        </div>
        <div class="row g-3">
            <div class="col-6 mb-2">
                <label class="form-label" asp-for="DueDate">Due Date<span class="text-danger">*</span></label>
                <input asp-for="DueDate" type="date" class="form-control" required />
                <span asp-validation-for="DueDate" class="text-danger"></span>
            </div>
            <div class="col-6 mb-2">
                <label class="form-label" asp-for="Status">Status<span class="text-danger">*</span></label>
                <select asp-for="Status" class="form-select" required>
                    <option value="Pending">Pending</option>
                    <option value="Paid">Paid</option>
                    <option value="Partial">Partial</option>
                    <option value="Overdue">Overdue</option>
                    <option value="Waived">Waived</option>
                    <option value="Cancelled">Cancelled</option>
                </select>
                <span asp-validation-for="Status" class="text-danger"></span>
            </div>
        </div>
        <div class="row g-3">
            <div class="col-6 mb-2">
                <label class="form-label" asp-for="AmountPaid">Amount Paid</label>
                <input asp-for="AmountPaid" type="number" step="0.01" min="0" class="form-control" placeholder="0.00" />
                <span asp-validation-for="AmountPaid" class="text-danger"></span>
            </div>
            <div class="col-6 mb-2">
                <label class="form-label" asp-for="AmountOutstanding">Amount Outstanding</label>
                <input asp-for="AmountOutstanding" type="number" step="0.01" min="0" class="form-control" placeholder="0.00" />
                <span asp-validation-for="AmountOutstanding" class="text-danger"></span>
            </div>
        </div>
        <div class="row g-3">
            <div class="col-12 mb-2">
                <label class="form-label" asp-for="Notes">Notes</label>
                <textarea asp-for="Notes" class="form-control" rows="3" placeholder="Additional notes"></textarea>
                <span asp-validation-for="Notes" class="text-danger"></span>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"><i class="bx bx-x-circle me-1"></i>Cancel</button>
        <button type="submit" class="btn btn-primary"><i class="bx bx-save me-1"></i>Update</button>
    </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const originalAmountInput = document.getElementById('originalAmount');
    const discountAmountInput = document.getElementById('discountAmount');
    const finalAmountInput = document.getElementById('finalAmount');

    function calculateFinalAmount() {
        const originalAmount = parseFloat(originalAmountInput.value) || 0;
        const discountAmount = parseFloat(discountAmountInput.value) || 0;
        const finalAmount = originalAmount - discountAmount;
        
        // Ensure final amount is not negative
        finalAmountInput.value = Math.max(0, finalAmount).toFixed(2);
    }

    // Add event listeners for auto-calculation
    originalAmountInput.addEventListener('input', calculateFinalAmount);
    discountAmountInput.addEventListener('input', calculateFinalAmount);
    
    // Calculate initial value
    calculateFinalAmount();
});
</script>
